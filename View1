-- Step 1: Fetch the data and apply the filter
WITH df_f1_temp AS (
    SELECT fdo_id, fdo_nm, local_bt
    FROM ealdb.da_inventory_data
),
df_bus_term_temp AS (
    SELECT fdo_id, bus_term_nm
    FROM ealdb.fdo_bus_term
    WHERE act_in = 'Y'
)

-- Step 2: Perform an outer join and apply the conditional logic
SELECT 
    df_f1_temp.fdo_id,
    df_f1_temp.fdo_nm,
    df_f1_temp.local_bt,
    df_bus_term_temp.bus_term_nm,

    -- Collibra_existence_indicator: True if local_bt is not null, False otherwise
    CASE 
        WHEN df_f1_temp.local_bt IS NULL THEN FALSE
        ELSE TRUE
    END AS collibra_existence_indicator,

    -- dq_inventory_indicator: True if bus_term_nm is not null, False otherwise
    CASE 
        WHEN df_bus_term_temp.bus_term_nm IS NULL THEN FALSE
        ELSE TRUE
    END AS dq_inventory_indicator

-- Step 3: Perform the outer join on fdo_id
FROM df_f1_temp
FULL OUTER JOIN df_bus_term_temp
ON df_f1_temp.fdo_id = df_bus_term_temp.fdo_id;
